import{_ as j,o as $,c as C,b as e,a as n,t as F,r as h,w as z,q as J,d as s,e as g,u as I,n as Q,f as N,N as B,g as W,j as R,p as U,k as K,l as X,m as Y,F as E,s as Z}from"./index-Cd1zkV47.js";import{_ as V}from"./Avatar--ZSpxiPA.js";import{i as ee,a as te,b as se,_ as L,c as oe,d as ne,e as ae}from"./addNew-B3AAzC9k.js";import{d as A}from"./vuedraggable.umd-BSsUEjrZ.js";import{u as M,_ as ce,a as le}from"./Switch-Dl5uCnTf.js";import{_ as q,N as ie}from"./headers-BCWK01Wb.js";import"./Tag-Cly_3Q5D.js";const _e={class:"wrap"},re={class:"name"},ue={__name:"GroupIcon",props:{element:Object},setup(a){return(y,r)=>{const u=V;return $(),C("div",_e,[e(u,{round:"",size:"10",src:a.element.img},null,8,["src"]),n("span",re,F(a.element.tag),1)])}}},H=j(ue,[["__scopeId","data-v-b3d5c154"]]),pe={class:"wrap"},me={class:"title"},de={class:"tag_name"},ve={class:"operate"},he={class:"switch"},fe={class:"box"},ge={__name:"GroupItem",props:{element:Object,list:Array},emits:["edit","remove","change"],setup(a,{emit:y}){const r=M(),u=y,c=a,d=h([]),f=h(!1),i=h(!1),w=[{label:"修改",key:"modify"},{label:"删除",key:"remove"}],O=(t,o)=>{d.value=[];const _=new Map;t.forEach(m=>{_.set(m.name,m)}),d.value=o.map(m=>_.get(m)).filter(Boolean)};z(()=>c.element,t=>{const o=t.sites.split(",");O(c.list,o),i.value=t.isOpen},{immediate:!0}),J(()=>{i.value=c.element.isOpen;const t=c.element.sites.split(",");O(c.list,t)});const G=t=>{u(t==="modify"?"edit":"remove",c.element)},v=()=>{f.value=!f.value},b=async t=>{const o=Object.assign(N(c.element),{isOpen:t});await window.myApi.updateGroup(o),u("change"),r.success("操作成功")},l=async t=>{try{const o=d.value.map(_=>_.name).join(",");await window.myApi.updateGroup(Object.assign(N(c.element),{sites:o})),r.success("保存成功")}catch(o){r.error("保存失败"+o)}};return(t,o)=>{const _=B,m=W,p=ce,S=H;return $(),C("div",pe,[n("div",me,[n("div",de,F(a.element.tag),1),n("div",ve,[e(m,{trigger:"click",options:w,onSelect:G},{default:s(()=>[n("span",{onClick:v},[e(_,{size:"20"},{default:s(()=>[e(ee)]),_:1})])]),_:1})]),n("div",he,[e(p,{size:"small",value:I(i),"onUpdate:value":[o[0]||(o[0]=k=>Q(i)?i.value=k:null),b],style:{"font-size":"10px"}},{checked:s(()=>[g("启用")]),unchecked:s(()=>[g("关闭")]),_:1},8,["value"])])]),n("div",fe,[e(I(A),{class:"list-group",list:I(d),group:a.element.name,onChange:l,itemKey:"name"},{item:s(({element:k,index:D})=>[e(S,{element:k},null,8,["element"])]),_:1},8,["list","group"])])])}}},we=j(ge,[["__scopeId","data-v-1e8b6621"]]),T=a=>(U("data-v-0ba16dee"),a=a(),K(),a),ye={class:"flex-row"},be={class:"box"},Se={class:"box"},xe=T(()=>n("br",null,null,-1)),$e=T(()=>n("p",{style:{color:"#888"}},[g(" 可拖动添加或者删除分组内的站点"),n("br"),g(" 分组内的站点也可以拖动排序"),n("br")],-1)),Oe={class:"flex-footer"},Ge={__name:"GroupDrawer",props:{element:Object,show:Boolean,list:Array},emits:["update:show","saveForm"],setup(a,{emit:y}){const r=M(),u=y,c=a,d=h("新增分组"),f=h([]),i=h([]),w=h(""),O=(l,t)=>{f.value=[],i.value=[];const o=t.sites.split(",").filter(Boolean),_=new Map;l.forEach(p=>{_.set(p.name,p)}),i.value=o.map(p=>_.get(p)).filter(Boolean);const m=new Set(o);f.value=l.filter(p=>!m.has(p.name))};z(()=>c.element,l=>{O(JSON.parse(JSON.stringify(c.list)),l),w.value=l.tag,d.value=l!=null&&l.name?"编辑站点":"新增分组"},{immediate:!0});const G=()=>{u("update:show",!1)},v=async()=>{if(!w.value)return r.error("分组名称不能为空");if(i.value.length===0)return r.error("分组下的站点不能为空");try{const l=i.value.map(o=>o.name),t={tag:w.value,sites:l.join(",")};await window.myApi.updateGroup(Object.assign(N(c.element),t)),r.success("保存成功"),u("saveForm",t),u("update:show",!1)}catch(l){r.error("保存失败"+l)}},b=l=>{console.log("sites.value",i.value)};return(l,t)=>{const o=le,_=H,m=q,p=B,S=L,k=oe,D=ne;return $(),R(D,{show:a.show,"onUpdate:show":t[1]||(t[1]=x=>u("update:show",x)),width:502,placement:"right"},{default:s(()=>[e(k,{title:d.value,closable:""},{footer:s(()=>[n("div",Oe,[e(S,{color:"#888",onClick:G},{icon:s(()=>[e(p,{color:"#fff"},{default:s(()=>[e(te)]),_:1})]),default:s(()=>[g(" 取消 ")]),_:1}),e(S,{color:"#2080f0",onClick:v},{icon:s(()=>[e(p,{color:"#fff"},{default:s(()=>[e(se)]),_:1})]),default:s(()=>[g(" 保存 ")]),_:1})])]),default:s(()=>[n("div",ye,[e(o,{type:"text",size:"large",placeholder:"分组名称",value:w.value,"onUpdate:value":t[0]||(t[0]=x=>w.value=x),clearable:""},null,8,["value"])]),n("div",be,[e(I(A),{class:"list-group",list:i.value,group:"site",onChange:b,itemKey:"name"},{item:s(({element:x,index:P})=>[e(_,{element:x},null,8,["element"])]),_:1},8,["list"])]),n("div",Se,[e(I(A),{class:"list-group list-all",list:f.value,group:"site",itemKey:"name"},{item:s(({element:x,index:P})=>[e(_,{element:x},null,8,["element"])]),_:1},8,["list"])]),xe,e(m,{"show-icon":!1},{default:s(()=>[$e]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}},ke=j(Ge,[["__scopeId","data-v-0ba16dee"]]),Ce=a=>(U("data-v-4288eb24"),a=a(),K(),a),Ie={id:"content-main"},Ne=Ce(()=>n("br",null,null,-1)),je={class:"box"},Ae={class:"box-title"},Be={class:"box-card"},Me={class:"wrap"},De={__name:"GroupView",setup(a){const y=M(),r=h([]),u=h([]),c=h(!1),d=h({tag:"",sites:"",isOpen:!1}),f=async()=>{try{r.value=(await window.myApi.getConfig()).openMenus,u.value=await window.myApi.getGroups()}catch(v){y.error("读取配置文件失败"+v)}};J(async()=>{await f()});const i=()=>{d.value={tag:"",sites:"",isOpen:!1},c.value=!0},w=v=>{d.value=JSON.parse(JSON.stringify(v)),c.value=!0},O=async v=>{try{await window.myApi.removeGroup(N(v)),y.success("删除成功")}catch(b){y.error("删除失败"+b)}await f()},G=async v=>{await f()};return(v,b)=>{const l=ie,t=q,o=B,_=L,m=we,p=X("auto-height");return $(),C(E,null,[n("div",Ie,[e(t,{"show-icon":!1,type:"info",style:{"margin-bottom":"1rem"}},{default:s(()=>[e(l,{style:{"margin-bottom":"0"}},{default:s(()=>[g("站点分组")]),_:1})]),_:1}),e(t,{"show-icon":!1},{default:s(()=>[g(" 1.没有创建或启用分组时，默认为全部站点;"),Ne,g(" 2.拖动站点图标可排序； ")]),_:1}),n("div",je,[n("div",Ae,[e(_,{color:"#2080f0",onClick:i},{icon:s(()=>[e(o,{color:"#fff"},{default:s(()=>[e(ae)]),_:1})]),default:s(()=>[g(" 添加分组 ")]),_:1})]),Y(($(),C("div",Be,[n("div",Me,[($(!0),C(E,null,Z(u.value,S=>($(),R(m,{element:S,list:r.value,onEdit:w,onRemove:O,onChange:G},null,8,["element","list"]))),256))])])),[[p,{offset:20}]])])]),e(ke,{show:c.value,"onUpdate:show":b[0]||(b[0]=S=>c.value=S),element:d.value,list:r.value,onSaveForm:G},null,8,["show","element","list"])],64)}}},Le=j(De,[["__scopeId","data-v-4288eb24"]]);export{Le as default};
